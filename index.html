<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Student Registration</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <style>
    body {
      font-family: Arial, sans-serif;
      background: #f2f4f7;
      display: flex;
      justify-content: center;
      align-items: center;
      height: 100vh;
      margin: 0;
    }
    .card {
      background: #ffffff;
      padding: 25px;
      width: 100%;
      max-width: 420px;
      border-radius: 8px;
      box-shadow: 0 2px 10px rgba(0,0,0,0.1);
    }
    h2 {
      text-align: center;
      margin-bottom: 20px;
    }
    label {
      font-weight: bold;
      margin-top: 10px;
      display: block;
    }
    input {
      width: 100%;
      padding: 8px;
      margin-top: 5px;
      box-sizing: border-box;
    }
    button {
      margin-top: 20px;
      width: 100%;
      padding: 10px;
      background: #0066cc;
      color: white;
      border: none;
      font-size: 16px;
      cursor: pointer;
    }
    button:disabled {
      background: #999;
      cursor: not-allowed;
    }
    .msg {
      margin-top: 15px;
      text-align: center;
      font-weight: bold;
      min-height: 20px;
    }
  </style>
</head>

<body>

<div class="card">
  <h2>Student Registration</h2>

  <form method="POST"
        action="https://script.google.com/macros/s/AKfycbyCLBfRhKU7UJbStta-pZK316z3AByZoEfAFa1lyx9ffzelOL6eKEv38v1J-IlMgf-6/exec"
        target="hiddenFrame"
        onsubmit="onSubmitForm()">

    <label>Name</label>
    <input type="text" name="name" id="name" required>

    <label>Roll Number</label>
    <input type="text" name="roll" id="roll" required>

    <label>Date of Birth</label>
    <input type="date" name="dob" id="dob" required>

    <button type="submit" id="submitBtn">Submit</button>
  </form>

  <iframe name="hiddenFrame"
          style="display:none;"
          onload="handleResponse()">
  </iframe>

  <div class="msg" id="msg"></div>
</div>

<script>
let awaitingResponse = false;

function onSubmitForm() {
  const msg = document.getElementById("msg");
  const btn = document.getElementById("submitBtn");

  awaitingResponse = true;
  msg.style.color = "black";
  msg.innerText = "Submitting...";
  btn.disabled = true;
}

function handleResponse() {
  if (!awaitingResponse) return;

  const iframe = document.getElementsByName("hiddenFrame")[0];
  if (!iframe || !iframe.contentDocument) return;

  const text = iframe.contentDocument.body.innerText.trim();

  // ðŸ”‘ Ignore empty iframe loads
  if (!text) return;

  awaitingResponse = false;

  const msg = document.getElementById("msg");
  const btn = document.getElementById("submitBtn");

  if (text === "SUCCESS") {
    msg.style.color = "green";
    msg.innerText = "Registration successful!";

    document.getElementById("name").value = "";
    document.getElementById("roll").value = "";
    document.getElementById("dob").value  = "";

    btn.disabled = true;
  }
  else if (text === "DUPLICATE") {
    msg.style.color = "red";
    msg.innerText = "Already registered!";
    btn.disabled = false;
  }
  else if (text === "MISSING") {
    msg.style.color = "red";
    msg.innerText = "All fields are mandatory!";
    btn.disabled = false;
  }
  else {
    msg.style.color = "red";
    msg.innerText = "Submission error. Please try again.";
    btn.disabled = false;
  }
}
</script>

</body>
</html>
